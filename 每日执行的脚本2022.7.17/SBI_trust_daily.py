#! -*- utf-8 -*-
import re
import json
import time
from lxml import etree
from selenium import webdriver
import pymysql
driver = webdriver.Chrome()




def use_selenium_headless_getdt(url):
    driver.get(url)
    html = driver.page_source
    return html







def readjsonfile(filename):
    with open(filename, 'r', encoding='utf-8') as fw:
        s = json.load(fw)
        return s


def insertDB(content):
    connection = pymysql.connect(host='127.0.0.1', port=3306, user='root', password='123456', db='Trust',
                                 charset='utf8mb4', cursorclass=pymysql.cursors.DictCursor)
    cursor = connection.cursor()
    try:
        f_ls = "%s," * (420)
        print(len(f_ls[:-1].split(",")))
        cursor.executemany('insert into SBI_trust_daily_dt (td101312203,td101314203,td101315203,td101316203,td201311052,td201311171,td201311211,td201311842,td20131200B,td201312083,td201312171,td201313135,td201313139,td20131315B,td20131317A,td20131318B,td201314133,td20131510B,td20131613B,td201316951,td201318164,td20131A10B,td202311089,td202311133,td20231116C,td20231118A,td202311202,td202311207,td202311215,td20231121C,td202311886,td202312038,td202312136,td202312145,td202312158,td202312177,td202312179,td20231217B,td202312188,td20231218A,td202313043,td20231314B,td20231396C,td202314097,td202314208,td202316097,td20231Q01A,td203311061,td20331109A,td203311112,td20331111A,td203311135,td203311138,td203311156,td203311167,td203311182,td203311187,td203311188,td20331118B,td203311191,td20331119A,td203311215,td203311946,td20331194A,td20331209A,td203312107,td20331212E,td20331213B,td203312161,td203312175,td203312184,td20331218C,td203312195,td203312196,td20331219A,td203312215,td203312223,td203312968,td203313047,td20331314B,td203313188,td20331318C,td203313195,td20331319B,td203313215,td20331409A,td203314177,td20331418A,td20331419B,td20331508B,td20331509A,td203315177,td203316042,td20331609A,td203316126,td203316136,td203316158,td203316183,td20331709A,td20331713A,td20331713C,td203317172,td203317178,td203317211,td20331809A,td203318172,td203319172,td203319211,td20331A172,td20331A211,td20331C177,td20331E13A,td20331Z176,td204311045,td204311047,td204311139,td204311181,td204311225,td204311859,td204312047,td204312056,td204312083,td20431216C,td20431218A,td204312211,td204312212,td204312217,td204313056,td204313181,td204313208,td204313215,td204314056,td204314086,td204314142,td204314181,td204314208,td204314214,td204315188,td204315213,td204316188,td204316203,td204316208,td204316209,td204317188,td20431720A,td204317213,td204318178,td20431820A,td204319178,td20431B214,td20431C136,td20431C138,td20431M169,td20431N169,td20431O169,td20431P169,td20431Q169,td20431R169,td20431U169,td20431X169,td209311143,td209312134,td210311134,td210311202,td210311222,td21031186A,td210312128,td210313128,td21031A169,td212311116,td212312044,td21231416C,td212316014,td217311019,td217311117,td217311134,td217311917,td217312137,td21731798B,td218311197,td218312991,td225311177,td225311203,td225312203,td225314203,td225316203,td229311031,td229311041,td229311062,td22931111B,td22931113C,td229311148,td229311161,td229311177,td229312031,td229312138,td22931213C,td229312152,td229312154,td229312206,td22931313C,td229313158,td22931316B,td229314136,td229314151,td22931513A,td22931517A,td22931617A,td23231103C,td23231112C,td23231199B,td23231203C,td232312135,td232312136,td232313135,td232313185,td232313984,td232314984,td232315984,td233311963,td23431218A,td235311135,td235311156,td23531199B,td235312149,td23531299B,td239311065,td239311149,td239312065,td239312149,td240311181,td240311201,td24231104A,td242311052,td24231108A,td242311091,td24231111C,td24231113C,td242311162,td242311184,td242312105,td242312162,td242313177,td245311131,td24531121C,td245311225,td245312138,td24531413A,td247311008,td24731101C,td247311046,td247311049,td247311136,td247311156,td247311163,td24731116A,td247311988,td247312002,td24731216A,td247312197,td247312201,td24731285A,td247313046,td24731312A,td247313162,td247313177,td247313179,td24731317B,td24731403A,td24731517B,td247316169,td247317173,td24731815C,td247318173,td24731915C,td247319173,td24731A15C,td24731B15C,td24731C15C,td24731D15C,td248311032,td24831207C,td248313159,td24831L139,td24831M139,td24931112B,td249311134,td24931116A,td249311176,td249311204,td250311092,td251311021,td25131104B,td251311063,td25131120B,td251312073,td25331108A,td253311119,td253311137,td253311175,td253312175,td25531112B,td258311008,td258311081,td25831110C,td264311051,td264311081,td264311107,td264311137,td264311138,td26431113B,td26431113C,td26431117B,td26431117C,td26431208C,td264312104,td26431218A,td26431218C,td264313081,td264313104,td264313193,td264314081,td264315081,td264315091,td264315094,td264316081,td26431613B,td264317168,td26431717B,td264318081,td26431917B,td268311003,td268311216,td27231109B,td279311114,td279311118,td279311169,td279312021,td279312024,td279312059,td279312107,td27931211C,td27931306A,td27931306C,td279313165,td27931316B,td279314169,td27931419A,td279315133,td27931519A,td27931603B,td27931C01A,td280311083,td283311049,td28331106B,td28331109B,td28531121C,td289311077,td289311135,td289311157,td28931115C,td28931117C,td289311181,td289311185,td289311199,td289311203,td289311216,td289311217,td289311218,td289311221,td289311223,td289312135,td289312136,td28931217C,td289312203,td289312216,td289312218,td28931221B,td289313135,td28931317C,td289313218,td289315135,td29331107A,td293311092,td293312139,td297311213,td297311223,td29731220A,td297312213,td297312216,td29A311105,td29A311128,td29A311148,td29A311196,td29C311125,td29C31119C,td29C313213,td29C314213,td29I311096,td29I31115A,td29I311161,td29I311179,td29I311181,td29I311187,td29I31119B,td29I311223,td29I312179,td29I312187,td29I312223,td29N311091,td29N31113C,td29R31106C,td29Y316137,td2AB311171,td2AJ31119A,td2AJ312178,td2AJ318178,td2AJ319178,td2B431119C,td2B4311203) values ({0})'.format(f_ls[:-1]),content)
        connection.commit()
        connection.commit()
        connection.close()
        print('向MySQL中添加数据成功！')
    except TypeError:
        pass


if __name__=="__main__":
    url_list = []
    _420_items_dt = []

    result = readjsonfile("sbi_trust.json")

    for item in result:
        url_list.append(item["url"])
    url_list.sort(reverse=False)
    for item in url_list:
        html = use_selenium_headless_getdt(item)
        selector = etree.HTML(html)
        last_price = selector.xpath(
            '//*[@id="MAINAREA02_780"]/div[2]/div[1]/div/div/div/div/div/div/div/table/tbody/tr[1]/td[2]/div/div[1]/text()')
        _420_items_dt.append("".join("".join(last_price).split(",")))
        print(last_price)
    f_tuple = tuple(_420_items_dt)
    print([f_tuple])
    insertDB([f_tuple])
    driver.close()






#  create table SBI_trust_daily_dt(id int not null primary key auto_increment,td101312203 TEXT,td101314203 TEXT,td101315203 TEXT,td101316203 TEXT,td201311052 TEXT,td201311171 TEXT,td201311211 TEXT,td201311842 TEXT,td20131200B TEXT,td201312083 TEXT,td201312171 TEXT,td201313135 TEXT,td201313139 TEXT,td20131315B TEXT,td20131317A TEXT,td20131318B TEXT,td201314133 TEXT,td20131510B TEXT,td20131613B TEXT,td201316951 TEXT,td201318164 TEXT,td20131A10B TEXT,td202311089 TEXT,td202311133 TEXT,td20231116C TEXT,td20231118A TEXT,td202311202 TEXT,td202311207 TEXT,td202311215 TEXT,td20231121C TEXT,td202311886 TEXT,td202312038 TEXT,td202312136 TEXT,td202312145 TEXT,td202312158 TEXT,td202312177 TEXT,td202312179 TEXT,td20231217B TEXT,td202312188 TEXT,td20231218A TEXT,td202313043 TEXT,td20231314B TEXT,td20231396C TEXT,td202314097 TEXT,td202314208 TEXT,td202316097 TEXT,td20231Q01A TEXT,td203311061 TEXT,td20331109A TEXT,td203311112 TEXT,td20331111A TEXT,td203311135 TEXT,td203311138 TEXT,td203311156 TEXT,td203311167 TEXT,td203311182 TEXT,td203311187 TEXT,td203311188 TEXT,td20331118B TEXT,td203311191 TEXT,td20331119A TEXT,td203311215 TEXT,td203311946 TEXT,td20331194A TEXT,td20331209A TEXT,td203312107 TEXT,td20331212E TEXT,td20331213B TEXT,td203312161 TEXT,td203312175 TEXT,td203312184 TEXT,td20331218C TEXT,td203312195 TEXT,td203312196 TEXT,td20331219A TEXT,td203312215 TEXT,td203312223 TEXT,td203312968 TEXT,td203313047 TEXT,td20331314B TEXT,td203313188 TEXT,td20331318C TEXT,td203313195 TEXT,td20331319B TEXT,td203313215 TEXT,td20331409A TEXT,td203314177 TEXT,td20331418A TEXT,td20331419B TEXT,td20331508B TEXT,td20331509A TEXT,td203315177 TEXT,td203316042 TEXT,td20331609A TEXT,td203316126 TEXT,td203316136 TEXT,td203316158 TEXT,td203316183 TEXT,td20331709A TEXT,td20331713A TEXT,td20331713C TEXT,td203317172 TEXT,td203317178 TEXT,td203317211 TEXT,td20331809A TEXT,td203318172 TEXT,td203319172 TEXT,td203319211 TEXT,td20331A172 TEXT,td20331A211 TEXT,td20331C177 TEXT,td20331E13A TEXT,td20331Z176 TEXT,td204311045 TEXT,td204311047 TEXT,td204311139 TEXT,td204311181 TEXT,td204311225 TEXT,td204311859 TEXT,td204312047 TEXT,td204312056 TEXT,td204312083 TEXT,td20431216C TEXT,td20431218A TEXT,td204312211 TEXT,td204312212 TEXT,td204312217 TEXT,td204313056 TEXT,td204313181 TEXT,td204313208 TEXT,td204313215 TEXT,td204314056 TEXT,td204314086 TEXT,td204314142 TEXT,td204314181 TEXT,td204314208 TEXT,td204314214 TEXT,td204315188 TEXT,td204315213 TEXT,td204316188 TEXT,td204316203 TEXT,td204316208 TEXT,td204316209 TEXT,td204317188 TEXT,td20431720A TEXT,td204317213 TEXT,td204318178 TEXT,td20431820A TEXT,td204319178 TEXT,td20431B214 TEXT,td20431C136 TEXT,td20431C138 TEXT,td20431M169 TEXT,td20431N169 TEXT,td20431O169 TEXT,td20431P169 TEXT,td20431Q169 TEXT,td20431R169 TEXT,td20431U169 TEXT,td20431X169 TEXT,td209311143 TEXT,td209312134 TEXT,td210311134 TEXT,td210311202 TEXT,td210311222 TEXT,td21031186A TEXT,td210312128 TEXT,td210313128 TEXT,td21031A169 TEXT,td212311116 TEXT,td212312044 TEXT,td21231416C TEXT,td212316014 TEXT,td217311019 TEXT,td217311117 TEXT,td217311134 TEXT,td217311917 TEXT,td217312137 TEXT,td21731798B TEXT,td218311197 TEXT,td218312991 TEXT,td225311177 TEXT,td225311203 TEXT,td225312203 TEXT,td225314203 TEXT,td225316203 TEXT,td229311031 TEXT,td229311041 TEXT,td229311062 TEXT,td22931111B TEXT,td22931113C TEXT,td229311148 TEXT,td229311161 TEXT,td229311177 TEXT,td229312031 TEXT,td229312138 TEXT,td22931213C TEXT,td229312152 TEXT,td229312154 TEXT,td229312206 TEXT,td22931313C TEXT,td229313158 TEXT,td22931316B TEXT,td229314136 TEXT,td229314151 TEXT,td22931513A TEXT,td22931517A TEXT,td22931617A TEXT,td23231103C TEXT,td23231112C TEXT,td23231199B TEXT,td23231203C TEXT,td232312135 TEXT,td232312136 TEXT,td232313135 TEXT,td232313185 TEXT,td232313984 TEXT,td232314984 TEXT,td232315984 TEXT,td233311963 TEXT,td23431218A TEXT,td235311135 TEXT,td235311156 TEXT,td23531199B TEXT,td235312149 TEXT,td23531299B TEXT,td239311065 TEXT,td239311149 TEXT,td239312065 TEXT,td239312149 TEXT,td240311181 TEXT,td240311201 TEXT,td24231104A TEXT,td242311052 TEXT,td24231108A TEXT,td242311091 TEXT,td24231111C TEXT,td24231113C TEXT,td242311162 TEXT,td242311184 TEXT,td242312105 TEXT,td242312162 TEXT,td242313177 TEXT,td245311131 TEXT,td24531121C TEXT,td245311225 TEXT,td245312138 TEXT,td24531413A TEXT,td247311008 TEXT,td24731101C TEXT,td247311046 TEXT,td247311049 TEXT,td247311136 TEXT,td247311156 TEXT,td247311163 TEXT,td24731116A TEXT,td247311988 TEXT,td247312002 TEXT,td24731216A TEXT,td247312197 TEXT,td247312201 TEXT,td24731285A TEXT,td247313046 TEXT,td24731312A TEXT,td247313162 TEXT,td247313177 TEXT,td247313179 TEXT,td24731317B TEXT,td24731403A TEXT,td24731517B TEXT,td247316169 TEXT,td247317173 TEXT,td24731815C TEXT,td247318173 TEXT,td24731915C TEXT,td247319173 TEXT,td24731A15C TEXT,td24731B15C TEXT,td24731C15C TEXT,td24731D15C TEXT,td248311032 TEXT,td24831207C TEXT,td248313159 TEXT,td24831L139 TEXT,td24831M139 TEXT,td24931112B TEXT,td249311134 TEXT,td24931116A TEXT,td249311176 TEXT,td249311204 TEXT,td250311092 TEXT,td251311021 TEXT,td25131104B TEXT,td251311063 TEXT,td25131120B TEXT,td251312073 TEXT,td25331108A TEXT,td253311119 TEXT,td253311137 TEXT,td253311175 TEXT,td253312175 TEXT,td25531112B TEXT,td258311008 TEXT,td258311081 TEXT,td25831110C TEXT,td264311051 TEXT,td264311081 TEXT,td264311107 TEXT,td264311137 TEXT,td264311138 TEXT,td26431113B TEXT,td26431113C TEXT,td26431117B TEXT,td26431117C TEXT,td26431208C TEXT,td264312104 TEXT,td26431218A TEXT,td26431218C TEXT,td264313081 TEXT,td264313104 TEXT,td264313193 TEXT,td264314081 TEXT,td264315081 TEXT,td264315091 TEXT,td264315094 TEXT,td264316081 TEXT,td26431613B TEXT,td264317168 TEXT,td26431717B TEXT,td264318081 TEXT,td26431917B TEXT,td268311003 TEXT,td268311216 TEXT,td27231109B TEXT,td279311114 TEXT,td279311118 TEXT,td279311169 TEXT,td279312021 TEXT,td279312024 TEXT,td279312059 TEXT,td279312107 TEXT,td27931211C TEXT,td27931306A TEXT,td27931306C TEXT,td279313165 TEXT,td27931316B TEXT,td279314169 TEXT,td27931419A TEXT,td279315133 TEXT,td27931519A TEXT,td27931603B TEXT,td27931C01A TEXT,td280311083 TEXT,td283311049 TEXT,td28331106B TEXT,td28331109B TEXT,td28531121C TEXT,td289311077 TEXT,td289311135 TEXT,td289311157 TEXT,td28931115C TEXT,td28931117C TEXT,td289311181 TEXT,td289311185 TEXT,td289311199 TEXT,td289311203 TEXT,td289311216 TEXT,td289311217 TEXT,td289311218 TEXT,td289311221 TEXT,td289311223 TEXT,td289312135 TEXT,td289312136 TEXT,td28931217C TEXT,td289312203 TEXT,td289312216 TEXT,td289312218 TEXT,td28931221B TEXT,td289313135 TEXT,td28931317C TEXT,td289313218 TEXT,td289315135 TEXT,td29331107A TEXT,td293311092 TEXT,td293312139 TEXT,td297311213 TEXT,td297311223 TEXT,td29731220A TEXT,td297312213 TEXT,td297312216 TEXT,td29A311105 TEXT,td29A311128 TEXT,td29A311148 TEXT,td29A311196 TEXT,td29C311125 TEXT,td29C31119C TEXT,td29C313213 TEXT,td29C314213 TEXT,td29I311096 TEXT,td29I31115A TEXT,td29I311161 TEXT,td29I311179 TEXT,td29I311181 TEXT,td29I311187 TEXT,td29I31119B TEXT,td29I311223 TEXT,td29I312179 TEXT,td29I312187 TEXT,td29I312223 TEXT,td29N311091 TEXT,td29N31113C TEXT,td29R31106C TEXT,td29Y316137 TEXT,td2AB311171 TEXT,td2AJ31119A TEXT,td2AJ312178 TEXT,td2AJ318178 TEXT,td2AJ319178 TEXT,td2B431119C TEXT,td2B4311203 TEXT,LastTime timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP )engine=MYISAM  charset=utf8;

# drop table SBI_trust_daily_dt;
#
#  ROW_FORMAT=COMPRESSED;




